# PRD: All-Replicate Content Engine

Hooks -> Scenes -> Video

Document status: MVP combined spec
Owner: Matt Berman
Stakeholders: Growth, Creative, Engineering, Ops
Target: Pilot in 3 weeks

---

## 1) Purpose and background

Build a repeatable system that converts market hooks into finished short videos with human control at key checkpoints. GPT-5 handles planning, clustering, validation, and strict JSON authoring. All media generation runs on Replicate models for a consistent API surface, job control, and reproducibility. The operator GUI lets non-engineers run the full pipeline.

---

## 2) Goals and non-goals

### Goals

- Ingest living brand context once and reuse everywhere.
- Mine competitor hooks, cluster patterns, and synthesize on-brand hooks per ICP.
- Produce consistent-character images and assemble 5 to 8 second video drafts.
- Optional voiceover or dialogue generated by Veo 3 when selected by the user.
- Keep humans in control with approvals, guardrails, and cost telemetry.
- Full audit trail with seeds, model version IDs, manifests, and logs.
- Ship an operator GUI for non-engineers.

### Non-goals

- No public marketing site in MVP.
- No auto publishing to channels without human approval.
- No model fine-tuning in v1.

---

## 3) Personas

- Strategist: uploads brand inputs, reviews synthesized hooks.
- Creative Lead: approves the character bible, tweaks scene prompts.
- Growth Operator: starts batches, tracks cost and success metrics.
- Editor: edits JSON in-tool, re-runs jobs, compares outputs.
- Owner: views performance, costs, and audit logs.

---

## 4) High-level pipeline

1. Brand ingest -> `brand_profile.json`
2. Scrape competitors and creators -> `hook_corpus.jsonl`
3. GPT-5 clustering and synthesis -> `hook_set.jsonl`
4. Character bible -> `character_profile.json`
5. GPT-5 scene planner -> `scene_specs.jsonl`
6. Replicate image generation -> `scene_images.jsonl`
7. Replicate video generation with Veo 3 -> MP4 drafts + `video_manifest.json`
8. Human gate -> export and analytics

---

## 5) Core models and APIs on Replicate

- Ideogram Character: consistent identity from a single reference, supports inpainting and speed modes.
- Imagen 4: high quality images, strong typography, aspect ratio control.
- Veo 3: text to video with optional voiceover or dialogue when enabled.
- Replicate API: HTTP and Python clients, Bearer auth, prediction lifecycle, polling and webhooks.

---

## 6) Functional requirements

### 6.1 Brand brain ingest

Inputs: tone samples, ICPs, proof points, banned claims, legal constraints
Process: GPT-5 extracts and normalizes into a strict schema
Output: `brand_profile.json` with objectives, constraints, and done-criteria

Acceptance

- JSON validates against schema.
- Banned claims flagged with reasons.
- Versioning applied on save.

### 6.2 Competitive hook mining

Scraper: ScrapeCreators is the preferred vendor.
Inputs: source list of competitor handles or URLs per platform
Process: ScrapeCreators returns post metadata, captions or transcripts, basic metrics
Output: `hook_corpus.jsonl`

Operational notes

- Support per-source rate limits, request IDs, and cursor pagination.
- Deduplicate by platform post ID and URL.
- Capture scrape latency and error category for observability.

Acceptance

- 200 plus items per seed list, under 1 percent parse error.

### 6.3 Pattern mining and hook synthesis

Process: GPT-5 clusters by ICP pain or gain, labels angles, proposes hooks
Output: `hook_set.jsonl` with hook text, angle, ICP tag, risk flags, inspiration URL

Acceptance

- 10 to 50 hooks per ICP segment.
- 70 percent plus pass tone and claims checks on first review.

### 6.4 Character bible

Choice

- Prefer Ideogram Character when identity consistency and mask-based edits matter.
- Use Imagen 4 for style flexibility or typography-heavy scenes.

Output: `character_profile.json` with reference image URLs, style constraints, mask rules

Acceptance

- Three approved looks remain stable across three test prompts.
- Seeds stored for reproducibility.

### 6.5 Scene planning and JSON prompt authoring

Process: for each hook, GPT-5 emits 3 to 5 scenes with setting, composition, camera, props, overlays, CTA, brand placement

Model-specific JSON fields

- Ideogram Character: `prompt`, `character_reference_image`, `aspect_ratio`, `rendering_speed`, optional inpainting hints
- Imagen 4: `prompt`, `aspect_ratio`, `negative_prompt`, `sample_count`

Voice and dialogue planning

- Scenes may include either structured dialogue lines or a single voiceover prompt.
- Validation ensures at least one of `dialogue` or `vo_prompt` is empty unless the user explicitly enables audio.

Acceptance

- JSON passes schema validation and dry-run checks.
- Missing required fields blocked with clear errors.

### 6.6 Scene image generation

Process: call Replicate with selected model and inputs, poll or receive webhook
Output: hosted image URLs plus `scene_images.jsonl` with seeds, model versions, params

Acceptance

- 90 percent plus first pass success.
- All outputs tagged with seed and model version.

### 6.7 Video assembly with Veo 3

Process

- Build `video_manifest.json` that references scene images, transitions, motion prompts, overlays, and optional audio.
- Submit to Veo 3 on Replicate and retrieve MP4.

Audio modes

- `audio.mode = "none"` for no audio.
- `audio.mode = "voiceover"` for a single continuous VO using `vo_prompt`.
- `audio.mode = "dialogue"` for character-labeled lines that Veo 3 should perform in sequence.

Acceptance

- Draft renders play in-app at 720p or 1080p.
- If audio is enabled, timing aligns within 300 ms to overlay and scene cuts.

### 6.8 Human gate, export, analytics

Gate: approve claims and tone, request edits, re-run with locked seed or new seed
Exports: per channel aspect ratios with safe margins, local download or S3 handoff
Analytics: hook CTR, 3s and 8s retention, click-through, CPA, cost per asset

Acceptance

- Exports complete and include a CSV report of costs and metrics.

---

## 7) Data contracts

### 7.1 `brand_profile.json`

```json
{
  "brand_id": "noteworthy-spirits",
  "voice": {
    "principles": ["energetic", "confident", "founder-to-founder"],
    "banned_phrases": ["hangover-free"]
  },
  "icp_segments": [
    {
      "name": "DTC operators",
      "pains": ["rising CAC"],
      "gains": ["faster testing"]
    }
  ],
  "proof": ["3M impressions in 14 days", "catalog rights secured"],
  "legal_constraints": ["no medical claims"],
  "objectives": ["lead gen", "email capture", "retargetable views"],
  "done_criteria": ["5 hooks ship with approved scenes and video drafts"]
}
```

### 7.2 `hook_corpus.jsonl` one line example

```json
{
  "platform": "tiktok",
  "author": "@creator",
  "url": "https://...",
  "metrics": { "views": 1200345, "likes": 54000, "comments": 1200 },
  "caption_or_transcript": "Everyone is wrong about...",
  "detected_format": "pattern_interrupt",
  "scraper": "scrapecreators",
  "scrape_meta": { "request_id": "sc_abc123", "latency_ms": 842 }
}
```

### 7.3 `hook_set.jsonl`

```json
{
  "hook_text": "Your CAC is not high, your loop is broken.",
  "angle": "contrarian",
  "icp": "DTC operators",
  "risk_flags": ["implied guarantee"],
  "inspiration_url": "https://..."
}
```

### 7.4 `character_profile.json`

```json
{
  "reference_images": ["https://s3/.../mascot-headshot.png"],
  "style_constraints": ["studio key light", "clean typography"],
  "mask_rules": ["preserve face", "replace background only"]
}
```

### 7.5 `scene_specs.jsonl` with audio fields

```json
{
  "scene_id": "hook1_s1",
  "duration_s": 2.0,
  "composition": "tight mid on mascot, text plate right",
  "props": ["phone", "chart"],
  "overlays": [{ "type": "lower_third", "text": "Fix your loop" }],
  "model": "ideogram-character",
  "model_inputs": {
    "prompt": "mascot in startup office, confident expression",
    "character_reference_image": "https://s3/.../mascot-headshot.png",
    "aspect_ratio": "9:16",
    "rendering_speed": "Default"
  },
  "audio": {
    "dialogue": [
      {
        "character": "Mascot",
        "line": "Your CAC is fine. Your loop is broken."
      }
    ],
    "vo_prompt": ""
  }
}
```

### 7.6 `scene_images.jsonl`

```json
{
  "scene_id": "hook1_s1",
  "image_url": "https://replicate.delivery/.../image.png",
  "seed": 123456789,
  "model_version": "ideogram-ai/ideogram-character@cdb13abf...",
  "params": { "aspect_ratio": "9:16", "rendering_speed": "Default" }
}
```

### 7.7 `video_manifest.json` with audio controls

```json
{
  "order": ["hook1_s1", "hook1_s2", "hook1_s3"],
  "transitions": "hard_cuts",
  "motion": "subtle parallax, 110 percent push",
  "overlays": [{ "time": 0.2, "type": "cta", "text": "Get the playbook" }],
  "audio": {
    "mode": "voiceover",
    "provider": "veo3",
    "voice_style": "confident_casual",
    "language": "en",
    "pace": "fast",
    "volume": "normal",
    "vo_prompt": "Confident voiceover that says: Your CAC is fine. Your loop is broken. Fix your loop, win your market.",
    "dialogue_timing": []
  }
}
```

Notes

- If `audio.mode = "dialogue"`, `vo_prompt` is empty and `dialogue_timing` maps `scene_id` and timestamps to lines.
- If `audio.mode = "none"`, omit the rest of the audio object.

---

## 8) Operator GUI

### 8.1 Objectives

Let non-engineers run Hooks -> Scenes -> Video end to end with optional audio.

### 8.2 Information architecture

Primary nav: Dashboard, Brand Ingest, Hooks, Character, Scenes, Renders, Videos, Review and Export, Settings

### 8.3 Screens and key interactions

Dashboard

- Tiles: Active batches, In-progress jobs, Failures, Spend today, Avg render time
- Table: Recent assets with status, model, seed, cost, actions
- Realtime updates within 3 seconds

Brand Ingest

- Wizard for voice, ICPs, proof, banned claims
- Live schema validate, save with version tag

Hooks

- Source setup for ScrapeCreators, mining progress, rate limits, retries
- Hook Corpus table and Synthesis panel
- Approve or edit hooks before scene planning

Character

- Upload reference, select model, set aspect ratio and mask rules
- Stability test: 3 prompts, A or B or C, lock seeds, approve bible

Scenes

- Hook picker, scene list, JSON editor with schema autocomplete and diff
- Audio panel per scene: add dialogue lines or a VO prompt
- Generate 3 to 5 scenes per hook, dry-run, queue for render

Renders

- Grid view with compare, show seed and model version
- Approve, reject with note, re-run with same seed, duplicate with new seed

Videos

- Manifest builder: drag scenes, transitions, motion
- Audio tab: Mode selector none or voiceover or dialogue, voice style, pace, language, volume, preview script
- Render with Veo 3, preview with transport controls and thumbnails

Review and Export

- Checklist: tone, claims, assets present
- Export presets: 9:16, 1:1, 16:9
- Download or push to S3, report as CSV

Settings

- API keys for Replicate and ScrapeCreators
- Guardrails: max cost per batch, max concurrency
- Notifications: webhook or email on batch complete or failure

### 8.4 Frontend tech stack

React and Next.js, TypeScript, Tailwind, Monaco JSON editor, React Query, SSE or WebSocket, S3 signed uploads

### 8.5 UX details

Status chips, job drawer with raw request and logs, cost meter, keyboard shortcuts, accessibility AA

### 8.6 GUI acceptance

- A non-engineer completes an end to end batch with or without audio.
- Every asset shows seed, model ID, and cost.
- Failed jobs recover with a single re-run.
- JSON editor blocks invalid fields and shows human readable errors.
- Dashboard reflects job state changes within 3 seconds.

---

## 9) System architecture

Components

- Orchestrator service: GPT-5 calls for clustering, planning, validation, JSON authoring
- Scraper workers: ScrapeCreators adapter with rate control, request IDs, retries
- Render workers: Replicate predictions, polling and webhooks, error categorization
- Storage: object store for assets, Postgres for metadata, costs, audit logs
- Operator GUI: talks to service API, streams job status

External APIs

- Replicate predictions API
- Model endpoints for Ideogram Character, Imagen 4, Veo 3
- ScrapeCreators for TikTok, IG, YouTube metadata and transcripts

Orchestration policies

- Parallelize by ICP and by hook
- Cache shared prompts and templates
- Cap GPT-5 reasoning effort on extraction and validation phases
- Backoff with jitter on Replicate or scraper errors
- Dry-run before any publish or export to paid channels

---

## 10) Service API

POST `/ingest/brand` -> `brand_profile.json` id
POST `/hooks/mine` -> `hook_corpus.jsonl` id
POST `/hooks/synthesize` -> `hook_set.jsonl` id
POST `/character/profile` -> `character_profile.json` id
POST `/scenes/plan` -> `scene_specs.jsonl` id
POST `/scenes/render` -> `scene_images.jsonl` id
POST `/videos/assemble` -> video asset URL

Audio fields for `/videos/assemble` body

```json
{
  "images_id": "img_batch_01",
  "manifest": {
    "order": ["hook1_s1", "hook1_s2"],
    "transitions": "hard_cuts",
    "motion": "subtle parallax",
    "audio": {
      "mode": "voiceover",
      "provider": "veo3",
      "voice_style": "confident_casual",
      "language": "en",
      "pace": "fast",
      "volume": "normal",
      "vo_prompt": "Confident voiceover that says: Your CAC is fine..."
    }
  }
}
```

Streams and utility

- GET list and detail for each artifact id
- SSE or WebSocket at `/jobs/stream` for prediction status
- Signed URL endpoint for uploads
- JWT auth with role permissions

---

## 11) Telemetry and analytics

- Cost ledger per asset: GPT tokens, Replicate run IDs, model versions, run duration
- Success metrics: CTR, 3s and 8s retention, click-through, CPA
- Reliability: retry counts, failure categories, time to render
- Batch report export as CSV

---

## 12) Security and compliance

- Secrets in a vault
- Per-request correlation IDs and audit logs
- Signed URLs for uploads and downloads
- Enforce banned claims from `brand_profile.json`
- Preserve any watermarks and metadata from upstream models

---

## 13) Nonfunctional requirements

- Performance: initial GUI load under 2 seconds on broadband, 1k row tables interactive under 5 seconds
- Reliability: idempotent re-submissions, circuit breakers on external calls
- Observability: structured logs, metrics, traces, alerts on error spikes
- Availability: 99.5 percent during pilot hours

---

## 14) Acceptance criteria, end to end

- System produces at least 5 approved hooks, 15 images, and 5 video drafts in a single batch
- All outputs carry seeds, model version IDs, and a manifest
- Operator can approve, edit JSON, re-run, and export channel-ready assets
- Cost per asset and total batch cost are visible and exported
- Audio mode works in both voiceover and dialogue settings when enabled

---

## 15) Rollout plan

Week 1

- Implement data contracts, orchestrator paths, Replicate integration for one image model and Veo 3
- GUI: Dashboard, Brand Ingest, Hooks
- SSE for job status
- ScrapeCreators adapter v0

Week 2

- Clustering and hook synthesis, Character, Scenes, Renders
- JSON editor with schema checks, cost meter, basic report
- ScrapeCreators hardening and pagination

Week 3

- Videos and Review and Export
- Audio controls for voiceover and dialogue in GUI
- Hardening on error handling, access control, and accessibility

---

## 16) Risks and mitigations

- Identity drift in images
  Mitigation: Ideogram Character with reference and masks, lock and reuse seeds, consistent prompts
- Video variance and long render times
  Mitigation: short 5 to 8 second drafts first, tight prompts, batch only winners
- Scraper fragility
  Mitigation: ScrapeCreators adapter with retries and dead-letter queue
- Cost creep
  Mitigation: preflight estimates, per-asset budget caps, caps on concurrent renders
- Audio alignment
  Mitigation: enforce script timings in `video_manifest.json`, allow manual nudge in GUI

---

## 17) Engineering notes

Replicate HTTP example

```bash
curl -s -X POST https://api.replicate.com/v1/predictions \
  -H "Authorization: Bearer $REPLICATE_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "version": "google/veo-3",
    "input": { "prompt": "dynamic push on our mascot, subtle motion, clean CTA" }
  }'
```

Python client example

```python
import replicate, os
os.environ["REPLICATE_API_TOKEN"] = "r8_***"
out = replicate.run(
  "ideogram-ai/ideogram-character",
  input={
    "prompt": "mascot at a standing desk, soft key light",
    "character_reference_image": "https://s3/.../mascot.png",
    "aspect_ratio": "9:16",
    "rendering_speed": "Default"
  }
)
print(out)
```

JSON schema stubs

- Provide schemas for `brand_profile.json`, `hook_corpus.jsonl` line, `hook_set.jsonl` line, `character_profile.json`, `scene_specs.jsonl` line, `scene_images.jsonl` line, `video_manifest.json`
- Enforce required fields and enums for `model`, `aspect_ratio`, `rendering_speed`
- Add enums for `audio.mode` in `video_manifest.json` and require `vo_prompt` if `mode = voiceover`, or `dialogue_timing` with per-line mapping if `mode = dialogue`
